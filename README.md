

- [$0 å®‰è£…](#0-å®‰è£…)
- [$1 åŠŸèƒ½å’Œæ¥å£æ³¨é‡Š](#1-åŠŸèƒ½å’Œæ¥å£æ³¨é‡Š)
  - [$1.1 è·å¾—å·¥å…·å®‰è£…ç”µè„‘ä¸Šçš„æ‰“å°æœºå’Œçº¸å¼ ä¿¡æ¯](#11-è·å¾—å·¥å…·å®‰è£…ç”µè„‘ä¸Šçš„æ‰“å°æœºå’Œçº¸å¼ ä¿¡æ¯)
  - [$1.2 æ·»åŠ ä¸€ä¸ªæ‰“å°æœºé…ç½®](#12-æ·»åŠ ä¸€ä¸ªæ‰“å°æœºé…ç½®)
  - [$1.3 è·å¾—æ‰“å°æœºé…ç½®](#13-è·å¾—æ‰“å°æœºé…ç½®)
  - [$1.4 åˆ é™¤ä¸€ä¸ªæ‰“å°æœºé…ç½®](#14-åˆ é™¤ä¸€ä¸ªæ‰“å°æœºé…ç½®)
  - [$1.5 æ›´æ”¹ä¸€ä¸ªæ‰“å°æœºé…ç½®](#15-æ›´æ”¹ä¸€ä¸ªæ‰“å°æœºé…ç½®)
  - [$1.6 å‘ä¸€ä¸ªæ‰“å°å‘½ä»¤](#16-å‘ä¸€ä¸ªæ‰“å°å‘½ä»¤)
  - [$1.7 è·å¾—æ‰“å°è¿‡çš„é¡µé¢](#17-è·å¾—æ‰“å°è¿‡çš„é¡µé¢)
  - [$1.8 è®¾ç½®è¿œç«¯websocket server url](#18-è®¾ç½®è¿œç«¯websocket-server-url)
  - [$1.9 è·å¾—è¿œç«¯websocket åœ°å€](#19-è·å¾—è¿œç«¯websocket-åœ°å€)
- [$2 æºç å’Œç¼–è¯‘](#2-æºç å’Œç¼–è¯‘)
- [$3 å®‰å…¨é—®é¢˜](#3-å®‰å…¨é—®é¢˜)


> ä¸€ä¸ªå®ç°ç½‘é¡µæ‰“å°è‡ªåŠ¨åŒ–çš„å·¥å…·

å‡è®¾ä½ åœ¨å¼€å‘ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿï¼Œä½ ä½¿ç”¨webæŠ€æœ¯æ¥å¼€å‘å‰ç«¯ï¼Œä½ çš„å®¢æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—®ä½ çš„åº”ç”¨ã€‚ä½ å¯èƒ½ä¼šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼ŒæŠŠä¸€äº›ä¿¡æ¯æ‰“å°åˆ°çº¸å¼ ä¹‹ä¸Šã€‚ä½ çš„åšæ³•å¦‚ä¸‹ï¼š

1. ä½¿ç”¨htmlå’Œcssæ¥åˆ¶ä½œç¬¦åˆæ‰“å°éœ€æ±‚çš„é™æ€å†…å®¹ï¼Œä½¿ç”¨jsåµŒå…¥ä¸€äº›åŠ¨æ€å†…å®¹
2. å€Ÿç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨`window.print()`ï¼Œå½“ä½ çš„ç”¨æˆ·åšå‡ºç±»ä¼¼äºç‚¹å‡»ä¸€ä¸ªæŒ‰é’®è¿™æ ·çš„æ“ä½œæ—¶ï¼Œæ‰“å¼€æµè§ˆå™¨çš„æ‰“å°é¢„è§ˆå¯¹è¯æ¡†
3. ä½ çš„ç”¨æˆ·åœ¨æµè§ˆå™¨çš„æ‰“å°é¢„è§ˆå¯¹è¯æ¡†é‡Œè¿›è¡Œä¸‹ä¸€æ­¥çš„é€‰æ‹©æ‰“å°æœºã€çº¸å¼ ç­‰æ“ä½œ

è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªæ‰“å°éœ€æ±‚éƒ½éœ€è¦ä½ çš„ç”¨æˆ·æ‰‹åŠ¨è§¦å‘ã€‚å¦‚æœæ‰“å°ç»å¸¸å‘ç”Ÿï¼Œä½ å¯èƒ½ä¼šè€ƒè™‘ï¼Œå¯ä»¥è®©è¿™ä¸ªæµç¨‹è‡ªåŠ¨åŒ–å—ï¼Ÿæˆ‘ä»¬é¢„å…ˆé…ç½®å¥½æ‰“å°æœºã€æ‰“å°æ ¼å¼ç­‰ï¼Œå½“æ‰“å°éœ€æ±‚äº§ç”Ÿæ—¶ä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨è§¦å‘æ‰“å°ï¼Œè€Œæ˜¯è®©æ‰“å°è‡ªåŠ¨å®Œæˆã€‚

å› ä¸ºæµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ï¼Œåœ¨å¸¸è§„æµè§ˆå™¨ä¸Šä»…ä»…ä¾é ç½‘é¡µæ˜¯æ— æ³•å®Œæˆçš„ï¼Œè¿™ä¸ªå°å·¥å…·çš„ä½œç”¨å°±æ˜¯å¸®åŠ©ä½ å®ç°ç½‘é¡µçš„è‡ªåŠ¨åŒ–æ‰“å°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯è½¯ä»¶ï¼Œä½ éœ€è¦æŠŠå®ƒå®‰è£…åœ¨èƒ½è¿æ¥ç›¸åº”æ‰“å°æœºçš„ç”µè„‘ä¸Šã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ç»„æˆã€‚
```mermaid
graph LR
    subgraph å¯¹å¤–æ¥å£
        direction LR
        Http-Server
        Websocket-Server
        Websocket-Client
    end
       å¯¹å¤–æ¥å£-->chromeå†…æ ¸-->æ‰“å°æœºé©±åŠ¨

```

ä½ å¯ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼ä¸å®ƒäº¤äº’ã€‚

1. httpè¯·æ±‚çš„æ–¹å¼ã€‚
2. ä½¿ç”¨websocketå®¢æˆ·ç«¯ï¼Œå»è¿æ¥å®ƒçš„websocket æœåŠ¡çš„æ–¹å¼
3. ä½ æœ‰ä¸€ä¸ªwebsocketæœåŠ¡ï¼Œå‘Šè¯‰å®ƒè¿™ä¸ªæœåŠ¡çš„åœ°å€ï¼Œå®ƒä¼šå»è¿æ¥ä½ çš„websocketæœåŠ¡ã€‚

ä¸åŒçš„æ¥å£é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚


NOTE:


**å¦‚æœä½ ä½¿ç”¨Httpè¯·æ±‚çš„æ–¹å¼ï¼Œå¹¶ä¸”å‘èµ·httpè¯·æ±‚çš„åœ°ç‚¹æ˜¯åœ¨æµè§ˆå™¨çš„ç½‘é¡µä¸Š**ï¼Œè¯·æ³¨æ„[æ›´ç§æœ‰çš„è·¨åŸŸç­–ç•¥](https://wicg.github.io/private-network-access/)

ä½ å¯ä»¥åœ¨chromeå†…æ ¸æµè§ˆå™¨ä¸­è®¾ç½® chrome://flags/#block-insecure-private-network-requests ä¸ºdisabled æ¥é¿å…æ›´ç§æœ‰çš„è·¨åŸŸç­–ç•¥ã€‚

å®ƒçš„httpè¿”å›å¤´å·²åŒ…å«ï¼š

```javascript
Access-Control-Allow-Origin:*
Access-Control-Allow-Methods: GET, POST
Access-Control-Allow-Private-Network: true
Access-Control-Allow-Credentials: true
```
å»ºè®®ä½¿ç”¨fetchï¼Œä»¥é¿å…å…¶å®ƒçš„è·¨åŸŸã€‚


## $0 å®‰è£…

è¿™ä¸ªè½¯ä»¶éœ€è¦å®‰è£…ï¼Œå»[è¿™é‡Œ](https://github.com/ZhaoYouYa/webpage_printtool/releases/tag/web)ä¸‹è½½ä¸€ä¸ªå®‰è£…åŒ…ï¼Œç„¶åå®‰è£…å°±å¯ä»¥äº†ã€‚

ä¹‹åï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªè¿™æ ·çš„è½¯ä»¶ç•Œé¢ï¼š

![](/images/1.png)

ç‚¹å‡»"è§‚"(ğŸ™ƒ)æŒ‰é’®ï¼Œå®ƒä¼šä½¿ç”¨ä½ é»˜è®¤çš„æµè§ˆå™¨æ‰“å¼€ä¸€ä¸ªé¡µé¢å¤§æ¦‚å¦‚ä¸‹ï¼š

![](/images/2.png)

ç«¯å£æ˜¯8847ã€‚

NOTE:

1. å®‰è£…åŒ…ä»…æ”¯æŒwindows 64ä½ã€‚qtæ˜¯è·¨å¹³å°çš„ï¼Œå¦‚æœä½ æœ‰å…¶å®ƒéœ€æ±‚ï¼Œå¯ä»¥è‡ªè¡Œç¼–è¯‘ã€‚
2. å®‰è£…ä½ç½®åœ¨ C:\\Program Files\\PrintWebPageä¸­ã€‚åŒæ—¶å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¼šæ·»åŠ ä¸€ä¸ªæ³¨å†Œè¡¨é¡¹åœ¨HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run ä¸­ï¼Œåå­—æ˜¯ï¼šPrintWebPageï¼Œç”¨äº**å¼€æœºå¯åŠ¨**ã€‚
3. å¦‚æœå®‰è£…è¿‡ç¨‹ä¸­æœ‰ä¸€äº›é—®é¢˜ï¼Œå»[è¿™é‡Œ](https://aka.ms/vs/17/release/vc_redist.x64.exe)ä¸‹è½½ä¸€ä¸ªæœ€æ–°çš„vc++è¿è¡Œæ—¶åŒ…ã€‚ä½ çš„ç³»ç»Ÿå¥½ä¹…æ²¡æ›´æ–°äº†Â·Â·Â·

## $1 åŠŸèƒ½å’Œæ¥å£æ³¨é‡Š

å½“ä½ å®‰è£…å®Œæ¯•åï¼Œå°±å¯ä»¥ä½¿ç”¨æ¥å£ä¸å®ƒäº¤äº’äº†ã€‚æ‰€æœ‰æ•°æ®éƒ½æ˜¯jsonæ ¼å¼ã€‚æºç ç›®å½•é‡Œçš„`test`æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ï¼Œæ˜¯ä¸€äº›ä¾‹å­ã€‚ä½ ä¹Ÿå¯ä»¥çœ‹çœ‹ï¼Œè¿™ä¸ªå·¥å…·è‡ªå¸¦é…ç½®é¡µé¢ï¼Œå®ƒä¸»è¦æ˜¯ä½¿ç”¨websocketä¸äº¤äº’çš„ã€‚

### $1.1 è·å¾—å·¥å…·å®‰è£…ç”µè„‘ä¸Šçš„æ‰“å°æœºå’Œçº¸å¼ ä¿¡æ¯

*è¯·æ±‚ï¼š*
```json
{
    "Id": "your id",
    "MsgType": "GetPrintInfo"
}
```

*è¿”å›ï¼š*
```json
{
    "Id":"your id",
    "IsSuccess": true,
    "Result": [
        {
            "Papers": [
                {
                    "Id": 0,
                    "Key": "Letter",
                    "PaperName": "\u4fe1\u7eb8",
                    "PaperSize": "215.9_279.4mm"
                },
            ],
            "PrinterName":"\u5bfc\u51fa\u4e3aWPS PDF"
        }

    
    ]

}

```

Idï¼šç”±ä½ æ¥æŒ‡å®šï¼Œç”¨æ¥æ ‡è¯†ä¸€ä¸ªè¯·æ±‚ã€‚å·¥å…·ç»™ä½ çš„è¿”å›ä¸­å°†æºå¸¦è¿™ä¸ªå€¼ã€‚å®ƒåœ¨ä½ ä½¿ç”¨websocketæ—¶æœ‰ç”¨ï¼Œå¦‚æœä½ ä¸éœ€è¦å®ƒï¼Œå¯ä»¥ä¼ **ç©ºå­—ç¬¦ä¸²ï¼Œä¸è¦ä¼ é€’å…¶å®ƒç±»å‹å‚æ•°æˆ–è€…å¿½è§†å®ƒ**

MsgType:è¯·æ±‚çš„ç±»å‹ï¼Œè¿™é‡Œ `GetPrintInfo` å°±æ˜¯è·å¾—ç”µè„‘ä¸Šçš„æ‰“å°æœºå’Œçº¸å¼ ä¿¡æ¯ã€‚

Resultï¼šä½ éœ€è¦çš„ä¿¡æ¯ä¸€èˆ¬åœ¨æ¥å£è¿”å›çš„è¿™ä¸ªå­—æ®µé‡Œï¼Œåœ¨è¿™ä¸ªè¯·æ±‚ä¸­:`PrinterName`,è¡¨ç¤ºè¿™ä¸ªæ‰“å°æœºçš„åç§°ï¼Œ`Papers`,è¿™ä¸ªæ‰“å°æœºæ”¯æŒçš„çº¸å¼ ã€‚


### $1.2 æ·»åŠ ä¸€ä¸ªæ‰“å°æœºé…ç½®

æ ¹æ® 1.1 è¿”å›çš„ä¿¡æ¯,ä½ åº”è¯¥é…ç½®ä¸€ä¸‹æ‰“å°æœºã€‚

*è¯·æ±‚ï¼š*
```json
{
    "Id": "your id",
    "MsgType": "AddOnePrintConfig",
    "Data": {
        "Name": "Hi",
        "PrinterName": "å¯¼å‡ºä¸ºWPS PDF",
        "TopMargin": 0,
        "BottomMargin": 1,
        "LeftMargin": 2,
        "RightMargin": 2,
        "Orientation": "æ¨ªå‘",
        "PaperName": "A4"
    }
}
```

*è¿”å›ï¼š*
```json
{
    "Id":"your id",
    "IsSuccess":true,"Message":""
}
```
Data.Name:ä½ æŒ‡å®šçš„æ‰“å°æœºé…ç½®çš„åç§°ï¼Œå®ƒåº”è¯¥æ˜¯å”¯ä¸€çš„

PrinterName:ä½ åœ¨$1.1ä¸­è·å¾—çš„æ‰“å°æœºåç§°

PaperName:ä½ åœ¨ $1.1ä¸­è·å¾—çš„ä¸æ‰“å°æœºåŒ¹é…çš„çº¸å¼ åç§°

### $1.3 è·å¾—æ‰“å°æœºé…ç½®

å½“ä½ é…ç½®äº†ä¸€ä¸ªæ‰“å°æœºï¼Œé€šè¿‡è¿™ä¸ªæ¥å£è¿”å›ä½ çš„é…ç½®ã€‚

*è¯·æ±‚ï¼š*
```json
{
    "Id": "your id",
    "MsgType": "GetPrintConfigs"
}
```

*è¿”å›ï¼š*
```json
{
    "Id": "your id",
    "IsSuccess": true,
    "Result": [
        {
            "BottomMargin": 0,
            "Id": 2,
            "LeftMargin": 0,
            "Name": "te",
            "Orientation": "A4",
            "PaperName": "A4",
            "PrinterName": "OneNote for Windows 10",
            "RightMargin": 0,
            "TopMargin": 0
        },
    ]
}
```

Result.Id:ä¸€ä¸ªæ‰“å°æœºé…ç½®çš„å”¯ä¸€æ ‡è¯†ã€‚

### $1.4 åˆ é™¤ä¸€ä¸ªæ‰“å°æœºé…ç½®

*è¯·æ±‚ï¼š*
```json
{
    "Id": "your id",
    "MsgType": "DelOnePrintConfig",
    "Data": 1
},
```

*è¿”å›ï¼š*
```json
{"Id":"your id","IsSuccess":true,"Message":""}
```

### $1.5 æ›´æ”¹ä¸€ä¸ªæ‰“å°æœºé…ç½®

*è¯·æ±‚ï¼š*
```json
{
    "Id": "your id",
    "MsgType": "UpdateOnePrintConfig",
    "Data": {
        "Name": "test213",
        "PrinterName": "å¯¼å‡ºä¸ºWPS PDF",
        "TopMargin": 0,
        "BottomMargin": 1,
        "LeftMargin": 2,
        "RightMargin": 2,
        "Orientation": "æ¨ªå‘",
        "PaperName": "A4"
    }
},
```

*è¿”å›ï¼š*
```json
{"Id":"your id","IsSuccess":true,"Message":""}
```

### $1.6 å‘ä¸€ä¸ªæ‰“å°å‘½ä»¤

*è¯·æ±‚ï¼š*
```json
{
    "Id": "your id",
    "MsgType": "ToPrint",
    "Data": [
        {
            "PageUrl": "https://www.bing.com",
            "ConfigName": "sdf",
            "PrintMode": "LoadAchieve"
        }
    ]
}
```

*è¿”å›ï¼š*
```json
{
"Id":"your id",
"IsSuccess":true,
"Result":[{"IsSuccess":true,"Message":""}]
}

```

PageUrlï¼šéœ€è¦æ‰“å°çš„ç½‘é¡µ urlã€‚

ConfigNameï¼šä¸€ä¸ªæ‰“å°æœºé…ç½®åç§°ï¼Œä½ é¢„å…ˆé…ç½®çš„ã€‚

PrintModeï¼šå®ƒå†³å®šä»€ä¹ˆæ—¶å€™æ‰“å°è¿™ä¸ªé¡µé¢ã€‚å®ƒæœ‰ä¸¤ä¸ªå¯é€‰å€¼ï¼š LoadAchieveï¼Œå½“é¡µé¢åŠ è½½å®Œæˆ,å¼€å§‹æ‰“å°ï¼›JsPrintRequestå½“è¿™ä¸ªé¡µé¢è°ƒç”¨ window.print() æ—¶ï¼Œå¼€å§‹æ‰“å°ã€‚


### $1.7 è·å¾—æ‰“å°è¿‡çš„é¡µé¢

*è¯·æ±‚ï¼š*
```json
{
    "Id": "your id",
    "MsgType": "GetPrintedPages",
    "Data": {
        "Size": 20,
        "Page": 1
    }
}
```

*è¿”å›ï¼š*
```json
{
    "Id": "your id",
    "IsSuccess": true,
    "Result": {
        "Count": 1157,
        "Rows": [
            {
                "ConfigName": "test",
                "FromIp": "127.0.0.1",
                "FromType": "ServerWebsocket",
                "IsSuccess": true,
                "PageName": "https:/cn.bing.com",
                "PrintMode": "",
                "PrintTime": "2022-11-20 10:36:53.6500030"
            }
        ]
    }
}
```
### $1.8 è®¾ç½®è¿œç«¯websocket server url

*è¯·æ±‚ï¼š*
```json
{
    "Id": "your id",
    "MsgType": "InsertOrUpdateWebsocketUrl",
    "Data": "ws://127.0.0.1:8001"
}
```

*è¿”å›ï¼š*
```json
{"Id":"your id","IsSuccess":true}
```

### $1.9 è·å¾—è¿œç«¯websocket åœ°å€

*è¯·æ±‚ï¼š*
```json
        {
            "Id": "your id",
            "MsgType": "GetWebsocketUrl"
        }
```

*è¿”å›ï¼š*
```json
{
    "Id": "your id",
    "IsSuccess": true,
    "Result": {
        "IsConnected": true,
        "WebSocUrl": "ws://127.0.0.1:8008"
    }
}
```



æ ¸å¿ƒåŠŸèƒ½éƒ¨åˆ†ã€websocketå®¢æˆ·ç«¯ã€åŠguiä½¿ç”¨qtå¼€å‘ï¼›httpæœåŠ¡ä½¿ç”¨[drogon](https:drogon.org/); ä¸€ä¸ªå¯é€‰çš„å‰ç«¯å·¥å…·ä½¿ç”¨vue å’Œ [naive-ui](https:www.naiveui.com/)å¼€å‘ã€‚
 
## $2 æºç å’Œç¼–è¯‘

å¦‚æœä½ æ˜¯å®¢æˆ·ç«¯å¼€å‘ï¼Œä½ ä¸ä¼šé‡åˆ°ä»€ä¹ˆè‡ªåŠ¨æ‰“å°çš„é—®é¢˜ã€‚è¿™ä¸ªå·¥å…·ä¸»è¦ç”¨äºwebã€‚ä½¿ç”¨webè¿˜æ˜¯"ä¼ ç»Ÿ"çš„å®¢æˆ·ç«¯,å„æœ‰åˆ©å¼Šå§ã€‚webçš„é€‚ç”¨åœºæ™¯æ›´å¤šä¸€äº›ã€‚ã€‚ã€‚

ä»£ç åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š
1. é…ç½®å·¥å…·é¡µé¢ã€‚ä½¿ç”¨vue å’Œ naiveuiã€‚è¿™ä¸ªä½ å¯èƒ½å¾ˆç†Ÿæ‚‰äº†ã€‚
2. å·¥å…·æœ¬èº«ã€‚è¿™ä¸ªä½¿ç”¨C++ã€‚å¯¹äºäº†è§£C++çš„äººæ¥è¯´ï¼Œæ²¡å•¥ç‰¹åˆ«ï¼Œå°±æ˜¯ qt å’Œcmakeé‚£ä¸€å¥—ã€‚æˆ‘ä½¿ç”¨äº†vcpkg ä¸­çš„drogonåº“ï¼Œvcpkgæ˜¯å¾®è½¯ç»´æŠ¤çš„C++åŒ…ç®¡ç†å™¨ï¼Œdrogon æ˜¯å›½å†…å¤§ä½¬å¼€å‘çš„ä¸€ä¸ªC++çš„httpæœåŠ¡æ¡†æ¶ï¼Œä½ éƒ½å¯ä»¥è½»æ¾çš„æ‰¾åˆ°éå¸¸è¯¦ç»†çš„èµ„æ–™ã€‚


è¿™ä¸ªå·¥å…·ä½¿ç”¨MITå¼€æºåè®®ï¼Œå¼•ç”¨çš„ç¬¬ä¸‰æ–¹é™¤äº†qtçš„GPLåè®®ä¹‹å¤–ï¼Œéƒ½æ˜¯MITåè®®ã€‚

## $3 å®‰å…¨é—®é¢˜

å½“ä½ ä½¿ç”¨è¿™ä¸ªå·¥å…·æ—¶ï¼Œä½ çš„æ‰“å°æœºå¯èƒ½ä¼šåœ¨"ä¸çŸ¥ä¸è§‰"ä¸­è¢«æ§åˆ¶ï¼Œå¦‚æœä½ çš„å¯¹åº”ç«¯å£æ˜¯æ‰“å¼€çš„ï¼Œé‚£ä¹ˆæ§åˆ¶ä½ æ‰“å°æœºçš„åœ°æ–¹å¯èƒ½åœ¨è¿œç«¯ã€‚æ€»ä¹‹ï¼Œä½ åº”è¯¥è€ƒè™‘å®‰å…¨é—®é¢˜ã€‚


